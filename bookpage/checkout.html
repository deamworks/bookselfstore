<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Checkout</title>

        <style>
            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');
            @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Poppins', sans-serif;
                background: #f8f8f8;
                padding: 40px;
            }

            .table-container {
                max-width: 1200px;
                margin: auto;
                background: white;
                padding: 25px;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            }

            table {
                width: 100%;
                border-collapse: collapse;
            }

            thead {
                background: #7c2220;
                color: white;
            }

            thead th {
                padding: 15px;
            }

            tbody td {
                padding: 15px;
                text-align: center;
                border-bottom: 1px solid #eee;
            }

            tbody tr:nth-child(even) {
                background: #fadbd9;
            }

            tbody tr:hover {
                background: #f5c6c3;
            }

            td img {
                width: 80px;
                border-radius: 6px;
                margin-bottom: 5px;
            }

            .book-name {
                text-align: left;
                font-weight: 500;
            }

            .book-name:lang(th) {
                font-family: 'Prompt', sans-serif;
            }

            .price {
                color: #7c2220;
                font-weight: bold;
            }

            button {
                font-family: 'Poppins', sans-serif;
                padding: 6px 15px;
                background: #7c2220;
                color: white;
                border: none;
                border-radius: 20px;
                cursor: pointer;
            }

            button:hover {
                background: #5f2119;
            }

            .summary {
                font-family: 'Prompt', sans-serif;
                margin-top: 40px;
                padding: 30px;
                border-radius: 10px;
                background: #fff3f2;
            }

            .cart-item {
                display: flex;
                justify-content: space-between;
                margin: 5px 0;
            }

            .remove-btn {
                font-family: 'Prompt', sans-serif;
                background: #999;
                padding: 3px 10px;
                border-radius: 10px;
                font-size: 12px;
            }

            .checkout-btn {
                font-family: 'Prompt', sans-serif;
                margin-top: 15px;
                width: 100%;
            }

            .receipt-modal {
                font-family: 'Prompt', sans-serif;
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.6);
                display: none;
                justify-content: center;
                align-items: center;
                z-index: 999;
            }

            .receipt-content {
                width: 600px;
                max-height: 90vh;
                overflow: auto;
                background: #fff;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            }

            .receipt-header {
                text-align: center;
                margin-bottom: 15px;
            }

            .receipt-header h2 {
                color: #7c2220;
                margin-bottom: 5px;
            }

            .receipt-content table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 15px;
            }

            .receipt-content th,
            .receipt-content td {
                border: 1px solid #ddd;
                padding: 8px;
                text-align: center;
            }

            .receipt-content th {
                background: #f3f3f3;
            }

            .total-section {
                margin-top: 15px;
                text-align: right;
            }

            .print-btn {
                font-family: 'Prompt', sans-serif;
                margin-top: 15px;
                width: 100%;
                background: #7c2220;
            }

            .back-btn {
                font-family: 'Prompt', sans-serif;
                margin-top: 15px;
                width: 100%;
                background: #555;
            }

            .back-btn:hover {
                background: #333;
            }

            .update-date {
                font-family: "Prompt", sans-serif;
            }

            tr:hover td.update-date {
                background-color: #fff;
            }

            .title-page {
                margin: 20px;
            }

            a {
                color: black;
                text-decoration: none;
            }

            /* CUSTOM ALERT POPUP */
            .alert-modal {
                font-family: 'Prompt', sans-serif;
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                display: none;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            }

            .alert-modal.show {
                display: flex;
            }

            .alert-box {
                background: #fff;
                border-radius: 15px;
                padding: 30px 35px;
                max-width: 380px;
                width: 90%;
                text-align: center;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
                animation: popIn 0.2s ease;
            }

            @keyframes popIn {
                from { transform: scale(0.85); opacity: 0; }
                to   { transform: scale(1);    opacity: 1; }
            }

            .alert-icon {
                font-size: 40px;
                margin-bottom: 10px;
            }

            .alert-title {
                font-size: 18px;
                font-weight: 600;
                color: #7c2220;
                margin-bottom: 8px;
            }

            .alert-message {
                font-size: 14px;
                color: #555;
                margin-bottom: 20px;
                line-height: 1.6;
            }

            .alert-ok-btn {
                font-family: 'Prompt', sans-serif;
                padding: 8px 35px;
                background: #7c2220;
                color: white;
                border: none;
                border-radius: 20px;
                cursor: pointer;
                font-size: 15px;
            }

            .alert-ok-btn:hover {
                background: #5f2119;
            }
        </style>
    </head>
    <h1 class="title-page" align="center">Check Out</h1>

    <body>

        <div class="table-container">

            <table>
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Name Book</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Status</th>
                        <th>Checkout</th>
                    </tr>
                </thead>

                <tbody>

                    <tr>
                        <td>
                            <a href="veil1.html">
                            <img src="../photo/theveil1.jpg"><br>4829571630</a></td>
                        <td class="book-name">Veil Volume 1: Temperature of Orange</td>
                        <td class="price" data-price="528">‡∏ø528.00</td>
                        <td class="stock">10</td>
                        <td>Available</td>
                        <td><button onclick="buy(this)">Buy</button></td>
                    </tr>

                    <tr>
                        <td>
                            <a href="veil2.html">
                            <img src="../photo/theveil2.jpg"><br>7391058246</a></td>
                        <td class="book-name">Veil Volume 2: Calming Noir</td>
                        <td class="price" data-price="528">‡∏ø528.00</td>
                        <td class="stock">10</td>
                        <td>Available</td>
                        <td><button onclick="buy(this)">Buy</button></td>
                    </tr>

                    <tr>
                        <td>
                            <a href="veil3.html">
                            <img src="../photo/theveil3.jpg"><br>1569047382</a></td>
                        <td class="book-name">Veil Volume 3: Graceful White</td>
                        <td class="price" data-price="529">‡∏ø529.00</td>
                        <td class="stock">10</td>
                        <td>Available</td>
                        <td><button onclick="buy(this)">Buy</button></td>
                    </tr>

                    <tr>
                        <td>
                            <a href="veil4.html">
                            <img src="../photo/veil4.jpg"><br>9082715643</a></td>
                        <td class="book-name">Veil Volume 4: Transparent Burns</td>
                        <td class="price" data-price="553">‡∏ø553.00</td>
                        <td class="stock">10</td>
                        <td>Available</td>
                        <td><button onclick="buy(this)">Buy</button></td>
                    </tr>

                    <tr>
                        <td>
                            <a href="veil5.html">
                            <img src="../photo/veil5.jpg"><br>6248190573</a></td>
                        <td class="book-name">Veil Volume 5: Golden Blink</td>
                        <td class="price" data-price="529">‡∏ø529.00</td>
                        <td class="stock">10</td>
                        <td>Available</td>
                        <td><button onclick="buy(this)">Buy</button></td>
                    </tr>

                    <tr>
                        <td>
                            <a href="veil6.html">
                            <img src="../photo/veil6.jpg"><br>3716409285</a></td>
                        <td class="book-name">Veil Volume 6: Untangled Rouge</td>
                        <td class="price" data-price="600">‡∏ø600.00</td>
                        <td class="stock">10</td>
                        <td>Available</td>
                        <td><button onclick="buy(this)">Buy</button></td>
                    </tr>

                    <tr>
                        <td>
                            <a href="veil7.html">
                            <img src="../photo/veil7.jpg"><br>8502947163</a></td>
                        <td class="book-name">Veil Volume 7: Warmest Blue</td>
                        <td class="price" data-price="536">‡∏ø536.00</td>
                        <td class="stock">10</td>
                        <td>Available</td>
                        <td><button onclick="buy(this)">Buy</button></td>
                    </tr>

                    <tr>
                        <td>
                            <a href="book1.html">
                            <img src="../photo/book1.gif"><br>2975318640</a></td>
                        <td class="book-name" lang="th">‡∏ó‡∏£‡∏ß‡∏á‡∏ó‡∏£‡∏≤‡∏°</td>
                        <td class="price" data-price="529">‡∏ø529.00</td>
                        <td class="stock">10</td>
                        <td>Available</td>
                        <td><button onclick="buy(this)">Buy</button></td>
                    </tr>

                    <tr>
                        <td>
                            <a href="book2.html">
                            <img src="../photo/book2.gif"><br>5648721903</a></td>
                        <td class="book-name" lang="th">‡πÑ‡∏ó‡∏¢‡∏ß‡∏¥‡∏à‡∏¥‡∏ï‡∏£</td>
                        <td class="price" data-price="399">‡∏ø399.00</td>
                        <td class="stock">10</td>
                        <td>Available</td>
                        <td><button onclick="buy(this)">Buy</button></td>
                    </tr>

                    <tr>
                        <td>
                            <a href="book3.html">
                            <img src="../photo/book3.gif"><br>9134067528</a></td>
                        <td class="book-name" lang="th">‡∏ú‡∏µ‡πÄ‡∏ô‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÇ‡∏•‡∏á‡∏ú‡∏∏</td>
                        <td class="price" data-price="420">‡∏ø420.00</td>
                        <td class="stock">10</td>
                        <td>Available</td>
                        <td><button onclick="buy(this)">Buy</button></td>
                    </tr>

                    <tr>
                        <td class="update-date" align="center" colspan="6">
                            ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏û ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <script>document.write(new Date().toLocaleDateString("th-TH"))</script>
                        </td>
                    </tr>

                </tbody>
            </table>

            <div class="summary">
                <h3>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <div id="cartList"></div>
                <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏•‡πà‡∏°‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="totalQty">0</span> ‡πÄ‡∏•‡πà‡∏°</p>
                <hr>
                <p>Subtotal: <span id="subtotal">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                <p>Discount 10% (‡∏Ñ‡∏£‡∏ö 5 ‡πÄ‡∏•‡πà‡∏°): <span id="discount">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                <p>VAT 7%: <span id="vat">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                <h3>Total Payment: <span id="total">0.00</span> ‡∏ö‡∏≤‡∏ó</h3>

                <button class="checkout-btn" onclick="checkout()">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>

                <a href="../index.html">
                    <button class="back-btn">‚Üê Back to Home</button>
                </a>
            </div>

        </div>

        <!-- CUSTOM ALERT POPUP-->
        <div class="alert-modal" id="alertModal">
            <div class="alert-box">
                <div class="alert-icon" id="alertIcon">‚ö†Ô∏è</div>
                <div class="alert-title" id="alertTitle">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                <div class="alert-message" id="alertMessage"></div>
                <button class="alert-ok-btn" onclick="closeAlert()">‡∏ï‡∏Å‡∏•‡∏á</button>
            </div>
        </div>

        <div class="receipt-modal" id="receiptModal">
            <div class="receipt-content" id="receipt"></div>
        </div>

        <script>
            const MAX_PER_BOOK = 5;

            let cart = {};
            let stocks = {};

            function showAlert(message, title = "‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", type = "warning") {
                const icons = { warning: "‚ö†Ô∏è", error: "üö´", success: "‚úÖ" };
                const colors = { warning: "#e67e22", error: "#7c2220", success: "#2e7d32" };

                document.getElementById("alertTitle").innerText = title;
                document.getElementById("alertMessage").innerText = message;
                document.getElementById("alertIcon").innerText = icons[type] || "‚ö†Ô∏è";
                document.getElementById("alertTitle").style.color = colors[type] || "#7c2220";
                document.getElementById("alertModal").classList.add("show");
            }

            function closeAlert() {
                document.getElementById("alertModal").classList.remove("show");
            }

            function buy(btn) {
                let row = btn.closest("tr");
                let id = row.cells[0].innerText.trim();
                let name = row.querySelector(".book-name").innerText;
                let price = parseFloat(row.querySelector(".price").dataset.price);
                let stockCell = row.querySelector(".stock");
                let statusCell = row.cells[4];

                if (!stocks[id]) stocks[id] = parseInt(stockCell.innerText);
                if (stocks[id] <= 0) { showAlert("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß", "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î", "error"); return; }

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô MAX_PER_BOOK ‡πÄ‡∏•‡πà‡∏°
                if (cart[id] && cart[id].qty >= MAX_PER_BOOK) {
                    statusCell.innerText = "Available";
                    showAlert(`‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${MAX_PER_BOOK} ‡πÄ‡∏•‡πà‡∏° ‡∏ï‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, "‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î", "warning");
                    return;
                }

                stocks[id]--;
                stockCell.innerText = stocks[id];

                if (cart[id]) cart[id].qty++;
                else cart[id] = { name, price, qty: 1 };

                // ‡∏ñ‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Status ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏° (‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô popup ‡πÅ‡∏ó‡∏ô)
                if (cart[id].qty >= MAX_PER_BOOK) {
                    statusCell.innerText = "Quota Full";
                } else if (stocks[id] <= 0) {
                    statusCell.innerText = "Sold Out";
                    btn.disabled = true;
                    btn.style.background = "#999";
                }

                renderCart();
            }

            function removeItem(id) {
                if (!cart[id]) return;

                cart[id].qty--;
                stocks[id]++;

                document.querySelectorAll("tr").forEach(row => {
                    if (row.cells[0] && row.cells[0].innerText.trim() == id) {
                        row.querySelector(".stock").innerText = stocks[id];
                        let currentQty = cart[id] ? cart[id].qty : 0;
                        if (stocks[id] > 0) {
                            // ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤ ‡∏Ñ‡∏∑‡∏ô Status ‡πÄ‡∏õ‡πá‡∏ô Available
                            if (currentQty < MAX_PER_BOOK) {
                                row.cells[4].innerText = "Available";
                            }
                            let buyBtn = row.querySelector("button");
                            buyBtn.disabled = false;
                            buyBtn.style.background = "#7c2220";
                        }
                    }
                });

                if (cart[id].qty <= 0) delete cart[id];
                renderCart();
            }

            function renderCart() {
                let cartList = document.getElementById("cartList");
                cartList.innerHTML = "";
                let subtotal = 0, totalQty = 0;

                for (let id in cart) {
                    let item = cart[id];
                    subtotal += item.price * item.qty;
                    totalQty += item.qty;

                    cartList.innerHTML += `
                        <div class="cart-item">
                            <span>${item.name} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${item.qty} ‡πÄ‡∏•‡πà‡∏°</span>
                            <button class="remove-btn" onclick="removeItem('${id}')">‡∏•‡∏ö</button>
                        </div>`;
                }

                let discount = totalQty >= 5 ? subtotal * 0.10 : 0;
                let totalAfterDiscount = subtotal - discount;
                let priceBeforeVAT = totalAfterDiscount / 1.07;
                let vat = totalAfterDiscount - priceBeforeVAT;

                document.getElementById("totalQty").innerText = totalQty;
                document.getElementById("subtotal").innerText = subtotal.toFixed(2);
                document.getElementById("discount").innerText = discount.toFixed(2);
                document.getElementById("vat").innerText = vat.toFixed(2);
                document.getElementById("total").innerText = totalAfterDiscount.toFixed(2);
            }

            function checkout() {
                if (Object.keys(cart).length === 0) { showAlert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô", "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤", "warning"); return; }

                let modal = document.getElementById("receiptModal");
                let receipt = document.getElementById("receipt");
                modal.style.display = "flex";

                let invoiceNo = "INV-" + Date.now();
                let date = new Date().toLocaleString("th-TH");

                let subtotal = parseFloat(document.getElementById("subtotal").innerText);
                let discount = parseFloat(document.getElementById("discount").innerText);
                let total = parseFloat(document.getElementById("total").innerText);
                let priceBeforeVAT = total / 1.07;
                let vat = total - priceBeforeVAT;

                let html = `
                    <div class="receipt-header">
                        <h2>Bookself Store</h2>
                        <p>www.bookselfstore.com</p>
                        <p>Invoice No: ${invoiceNo}</p>
                        <p>Date: ${date}</p>
                    </div>

                    <table>
                        <tr><th>Book</th><th>Qty</th><th>Price</th><th>Total</th></tr>
                `;

                for (let id in cart) {
                    let item = cart[id];
                    html += `<tr>
                        <td>${item.name}</td>
                        <td>${item.qty}</td>
                        <td>${item.price.toFixed(2)}</td>
                        <td>${(item.price * item.qty).toFixed(2)}</td>
                    </tr>`;
                }

                html += `
                    </table>
                    <div class="total-section">
                        <p>Subtotal: ${subtotal.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        <p>Discount: -${discount.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        <p>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡πà‡∏≠‡∏ô VAT: ${priceBeforeVAT.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        <p>VAT 7%: ${vat.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        <h3>Total: ${total.toFixed(2)} ‡∏ö‡∏≤‡∏ó</h3>
                    </div>

                    <button class="print-btn" onclick="confirmPurchase()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</button>
                `;

                receipt.innerHTML = html;
            }

            function confirmPurchase() {
                document.getElementById("receiptModal").style.display = "none";
                cart = {};
                renderCart();
                showAlert("‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Bookself Store", "‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "success");
            }
        </script>

    </body>
</html>